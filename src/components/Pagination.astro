---
import { pageNumbers, type PaginationInfo } from "../lib/pagination";

interface Props {
	pagination: PaginationInfo;
}

const { pagination } = Astro.props;
const { currentPage, totalPages } = pagination;

// Don't render if only one page
if (totalPages <= 1) return;

const pages = pageNumbers(currentPage, totalPages);

// Build URL for a given page, preserving existing query params.
// Includes #results hash so the browser scrolls to the card list.
function pageHref(page: number): string {
	const url = new URL(Astro.url);
	if (page === 1) {
		url.searchParams.delete("page");
	} else {
		url.searchParams.set("page", String(page));
	}
	return `${url.pathname}${url.search}#results`;
}

const chevronLeft = `<polyline points="15 18 9 12 15 6"></polyline>`;
const chevronRight = `<polyline points="9 18 15 12 9 6"></polyline>`;
---

<nav class="pagination" aria-label="Pagination">
	{currentPage > 1 ? (
		<a href={pageHref(currentPage - 1)} class="pagination-btn pagination-prev" aria-label="Go to previous page">
			<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
				<Fragment set:html={chevronLeft} />
			</svg>
			Previous
		</a>
	) : (
		<span class="pagination-btn pagination-prev disabled" aria-disabled="true">
			<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
				<Fragment set:html={chevronLeft} />
			</svg>
			Previous
		</span>
	)}

	<ol class="pagination-pages" role="list">
		{pages.map((page) =>
			page === null ? (
				<li class="pagination-ellipsis" aria-hidden="true">&hellip;</li>
			) : page === currentPage ? (
				<li>
					<span class="pagination-page active" aria-label={`Page ${page}`} aria-current="page">{page}</span>
				</li>
			) : (
				<li>
					<a href={pageHref(page)} class="pagination-page" aria-label={`Go to page ${page}`}>{page}</a>
				</li>
			)
		)}
	</ol>

	{currentPage < totalPages ? (
		<a href={pageHref(currentPage + 1)} class="pagination-btn pagination-next" aria-label="Go to next page">
			Next
			<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
				<Fragment set:html={chevronRight} />
			</svg>
		</a>
	) : (
		<span class="pagination-btn pagination-next disabled" aria-disabled="true">
			Next
			<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
				<Fragment set:html={chevronRight} />
			</svg>
		</span>
	)}
</nav>

<style>
	.pagination {
		display: flex;
		align-items: center;
		justify-content: center;
		gap: 0.5rem;
		margin-top: 1.5rem;
		padding: 1rem 0;
	}

	.pagination-btn {
		display: inline-flex;
		align-items: center;
		gap: 0.25rem;
		padding: 0.5rem 0.75rem;
		font-size: 0.8125rem;
		font-weight: 500;
		color: var(--color-link);
		text-decoration: none;
		border: 1px solid var(--color-border);
		border-radius: 6px;
		background: var(--color-bg);
		transition:
			border-color 0.15s,
			background-color 0.15s;
	}

	.pagination-btn:hover:not(.disabled) {
		border-color: var(--color-border-hover);
		background-color: var(--color-bg-secondary);
	}

	.pagination-btn.disabled {
		color: var(--color-text-secondary);
		opacity: 0.5;
		cursor: not-allowed;
	}

	.pagination-pages {
		display: flex;
		align-items: center;
		gap: 0.25rem;
		list-style: none;
		margin: 0;
		padding: 0;
	}

	.pagination-page {
		display: flex;
		align-items: center;
		justify-content: center;
		min-width: 2rem;
		height: 2rem;
		padding: 0 0.375rem;
		font-size: 0.8125rem;
		font-weight: 500;
		text-decoration: none;
		color: var(--color-text);
		border: 1px solid transparent;
		border-radius: 6px;
		transition:
			border-color 0.15s,
			background-color 0.15s;
	}

	.pagination-page:hover:not(.active) {
		border-color: var(--color-border);
		background-color: var(--color-bg-secondary);
	}

	.pagination-page.active {
		color: var(--color-accent-text);
		background-color: var(--color-accent);
		border-color: var(--color-accent);
		cursor: default;
	}

	.pagination-ellipsis {
		display: flex;
		align-items: center;
		justify-content: center;
		min-width: 2rem;
		height: 2rem;
		font-size: 0.8125rem;
		color: var(--color-text-secondary);
	}

	@media (max-width: 640px) {
		.pagination {
			gap: 0.25rem;
		}

		.pagination-btn {
			padding: 0.5rem;
			min-height: 44px;
			font-size: 0.75rem;
		}

		.pagination-page {
			min-width: 2.75rem;
			height: 2.75rem;
		}

		.pagination-ellipsis {
			min-width: 1.5rem;
		}
	}
</style>
