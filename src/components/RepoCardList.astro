---
// Server-rendered repo card list. Repos are fetched during SSR and passed as props,
// eliminating the client-side fetch that previously delayed LCP and caused CLS.
// Shared styles live in src/styles/repo-card.css (imported globally via Layout.astro).
import RepoCard from "./RepoCard.astro";
import type { TrendingRepo } from "../lib/trending";

interface Props {
	viewMode?: "daily" | "weekly";
	repos: TrendingRepo[];
}

const { viewMode = "daily", repos } = Astro.props;
---

{repos.length > 0 ? (
	<ol class="card-list-results" aria-label="Trending repositories">
		{repos.map((repo, i) => (
			<li>
				<RepoCard
					rank={i + 1}
					repoOwner={repo.repo_owner}
					repoName={repo.repo_name}
					description={repo.description}
					language={repo.language}
					languageColor={repo.language_color}
					totalStars={repo.total_stars}
					forks={repo.forks}
					starsToday={repo.stars_today}
					viewMode={viewMode}
				/>
			</li>
		))}
	</ol>
) : (
	<div class="card-list-empty">
		<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
			<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
			<polyline points="14 2 14 8 20 8"></polyline>
			<line x1="9" y1="15" x2="15" y2="15"></line>
		</svg>
		<p>No trending data available for this date.</p>
	</div>
)}

<style>
	.card-list-results {
		display: flex;
		flex-direction: column;
		gap: 0.75rem;
		list-style: none;
		margin: 0;
		padding: 0;
	}

	/* Empty state */
	.card-list-empty {
		display: flex;
		flex-direction: column;
		align-items: center;
		gap: 1rem;
		padding: 3rem 1rem;
		color: var(--color-text-secondary);
		text-align: center;
	}

	.card-list-empty p {
		margin: 0;
		font-size: 1rem;
	}
</style>
