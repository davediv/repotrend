---
// Server-side repo card used for SSR rendering.
// Shared styles live in src/styles/repo-card.css (imported globally via Layout.astro).
import { formatNumber, sanitizeHexColor } from "../lib/format";

interface Props {
	rank: number;
	repoOwner: string;
	repoName: string;
	description: string | null;
	language: string | null;
	languageColor: string | null;
	totalStars: number;
	forks: number;
	starsToday: number;
	viewMode?: "daily" | "weekly";
}

const {
	rank,
	repoOwner,
	repoName,
	description,
	language,
	languageColor,
	totalStars,
	forks,
	starsToday,
	viewMode = "daily",
} = Astro.props;

const repoUrl = `https://github.com/${repoOwner}/${repoName}`;
const safeColor = sanitizeHexColor(languageColor);
const headingId = `repo-heading-${rank}`;
const starsLabel = viewMode === "weekly" ? "this week" : "today";
---

<article class="repo-card" aria-labelledby={headingId}>
	<div class="repo-rank" aria-hidden="true">{rank}</div>
	<div class="repo-content">
		<h2 class="repo-name" id={headingId}>
			<span class="sr-only">#{rank}</span>
			<a href={repoUrl} target="_blank" rel="noopener noreferrer">
				<span class="repo-owner">{repoOwner}</span>
				<span class="repo-separator">/</span>
				<span class="repo-name-text">{repoName}</span>
			</a>
		</h2>

		{description && <p class="repo-description">{description}</p>}

		<div class="repo-meta">
			{language && (
				<span class="meta-item language">
					<span class="language-dot" style={safeColor ? `background-color: ${safeColor}` : undefined}></span>
					{language}
				</span>
			)}

			<span class="meta-item">
				<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
					<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
				</svg>
				<span class="sr-only">Total stars:</span>
				{formatNumber(totalStars)}
			</span>

			<span class="meta-item">
				<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
					<circle cx="12" cy="18" r="3"></circle>
					<circle cx="6" cy="6" r="3"></circle>
					<circle cx="18" cy="6" r="3"></circle>
					<path d="M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9"></path>
					<path d="M12 12v3"></path>
				</svg>
				<span class="sr-only">Forks:</span>
				{formatNumber(forks)}
			</span>

			<span class="meta-item stars-today">
				<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
					<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
				</svg>
				<span class="sr-only">Stars gained </span>
				{formatNumber(starsToday)} {starsLabel}
			</span>
		</div>
	</div>
</article>
