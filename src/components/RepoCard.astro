---
// Server-side repo card for SSR/SSG use (e.g., static page generation per UI-P1-011).
// Client-rendered equivalent lives in RepoCardList.astro â€” keep markup in sync.
import { formatNumber, sanitizeHexColor } from "../lib/format";

interface Props {
	rank: number;
	repoOwner: string;
	repoName: string;
	description: string | null;
	language: string | null;
	languageColor: string | null;
	totalStars: number;
	forks: number;
	starsToday: number;
}

const {
	rank,
	repoOwner,
	repoName,
	description,
	language,
	languageColor,
	totalStars,
	forks,
	starsToday,
} = Astro.props;

const repoUrl = `https://github.com/${repoOwner}/${repoName}`;
const safeColor = sanitizeHexColor(languageColor);
const headingId = `repo-heading-${rank}`;
---

<article class="repo-card" aria-labelledby={headingId}>
	<div class="repo-rank" aria-hidden="true">{rank}</div>
	<div class="repo-content">
		<h2 class="repo-name" id={headingId}>
			<span class="sr-only">#{rank}</span>
			<a href={repoUrl} target="_blank" rel="noopener noreferrer">
				<span class="repo-owner">{repoOwner}</span>
				<span class="repo-separator">/</span>
				<span class="repo-name-text">{repoName}</span>
			</a>
		</h2>

		{description && <p class="repo-description">{description}</p>}

		<div class="repo-meta">
			{language && (
				<span class="meta-item language">
					<span class="language-dot" style={safeColor ? `background-color: ${safeColor}` : undefined}></span>
					{language}
				</span>
			)}

			<span class="meta-item">
				<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
					<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
				</svg>
				<span class="sr-only">Total stars:</span>
				{formatNumber(totalStars)}
			</span>

			<span class="meta-item">
				<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
					<circle cx="12" cy="18" r="3"></circle>
					<circle cx="6" cy="6" r="3"></circle>
					<circle cx="18" cy="6" r="3"></circle>
					<path d="M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9"></path>
					<path d="M12 12v3"></path>
				</svg>
				<span class="sr-only">Forks:</span>
				{formatNumber(forks)}
			</span>

			<span class="meta-item stars-today">
				<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
					<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
				</svg>
				<span class="sr-only">Stars gained </span>
				{formatNumber(starsToday)} today
			</span>
		</div>
	</div>
</article>

<style>
	.repo-card {
		display: flex;
		gap: 1rem;
		padding: 1rem 1.25rem;
		border: 1px solid var(--color-border);
		border-radius: 6px;
		background: var(--color-bg);
		transition: border-color 0.15s;
	}

	.repo-card:hover {
		border-color: var(--color-text-secondary);
	}

	.repo-rank {
		flex-shrink: 0;
		display: flex;
		align-items: center;
		justify-content: center;
		width: 2rem;
		height: 2rem;
		border-radius: 50%;
		background: var(--color-bg-secondary);
		color: var(--color-text-secondary);
		font-size: 0.8125rem;
		font-weight: 600;
		font-variant-numeric: tabular-nums;
	}

	.repo-content {
		flex: 1;
		min-width: 0;
	}

	.repo-name {
		margin: 0;
		font-size: 1.125rem;
		font-weight: 600;
		line-height: 1.4;
	}

	.repo-name a {
		color: var(--color-link);
		text-decoration: none;
	}

	.repo-name a:hover {
		text-decoration: underline;
	}

	.repo-name a:focus-visible {
		outline: 2px solid var(--color-accent);
		outline-offset: 2px;
		border-radius: 2px;
	}

	.repo-owner {
		font-weight: 400;
		color: var(--color-link);
	}

	.repo-separator {
		color: var(--color-text-secondary);
		padding: 0 1px;
	}

	.repo-description {
		margin: 0.375rem 0 0;
		font-size: 0.875rem;
		color: var(--color-text-secondary);
		line-height: 1.5;
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}

	.repo-meta {
		display: flex;
		flex-wrap: wrap;
		align-items: center;
		gap: 1rem;
		margin-top: 0.625rem;
		font-size: 0.8125rem;
		color: var(--color-text-secondary);
	}

	.meta-item {
		display: inline-flex;
		align-items: center;
		gap: 0.25rem;
	}

	.meta-item svg {
		flex-shrink: 0;
	}

	.language-dot {
		display: inline-block;
		width: 12px;
		height: 12px;
		border-radius: 50%;
		background-color: var(--color-text-secondary);
	}

	.stars-today {
		color: var(--color-text);
		font-weight: 500;
	}

	@media (max-width: 640px) {
		.repo-card {
			padding: 0.75rem 1rem;
			gap: 0.75rem;
		}

		.repo-name {
			font-size: 1rem;
		}

		.repo-meta {
			gap: 0.75rem;
		}
	}
</style>
